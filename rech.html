<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recherche dans les Cours ‚Ä¢ Ivanipote</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.7.76/pdf.min.mjs" type="module"></script>
  <style>
    body { margin:0; background:#0a0a0a; color:white; font-family:'Segoe UI',sans-serif; }
    .container { max-width:1100px; margin:0 auto; padding:2rem 1rem; text-align:center; }
    h1 { font-size:3rem; color:#00ff9d; text-shadow:0 0 30px rgba(0,255,157,0.5); margin-bottom:1rem; }
    .search { width:90%; max-width:800px; padding:1.6rem 2rem; font-size:1.6rem; border-radius:50px; border:4px solid #00ff9d; background:#111; color:white; outline:none; text-align:center; margin:2rem auto; display:block; }
    .search:focus { box-shadow:0 0 40px rgba(0,255,157,0.8); }
    .status { color:#00ff9d; font-size:1.4rem; margin:2rem; }
    .results { display:grid; gap:1.5rem; grid-template-columns:repeat(auto-fill, minmax(360px,1fr)); margin-top:2rem; }
    .card { background:#111; border:2px solid #333; border-radius:16px; padding:1.8rem; text-align:left; transition:0.3s; }
    .card:hover { border-color:#00ff9d; box-shadow:0 10px 30px rgba(0,255,157,0.3); transform:translateY(-8px); }
    .name { font-size:1.5rem; color:white; margin-bottom:0.8rem; word-break:break-all; }
    .snippet { color:#b0ffdb; font-style:italic; line-height:1.5; margin:1rem 0; }
    .links a { color:#00ff9d; margin:0 1rem; text-decoration:none; font-weight:bold; }
    .no-results { font-size:2rem; color:#ff3366; margin-top:4rem; display:none; }
    footer { margin-top:5rem; color:#00ff9d; }
  </style>
</head>
<body>

  <div class="container">
    <h1>Recherche dans les Cours PDF</h1>
    <input type="text" id="search" class="search" placeholder="Tape un mot : contacteur, Pythagore, variateur, transformateur‚Ä¶" autofocus>

    <div class="status" id="status">Chargement du dossier pdf_cours‚Ä¶</div>

    <div id="results" class="results"></div>
    <p class="no-results" id="noResults">Aucun r√©sultat trouv√©</p>
  </div>

  <footer>¬© Ivanipote ‚Äì Recherche interne PDF 2025</footer>

  <script type="module">
    import { getDocument } from 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.7.76/pdf.min.mjs';
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.7.76/pdf.worker.min.mjs';

    const repo = "ivanipote/Telech";
    const folder = "lescourpdf";
    let pdfs = [];

    async function loadAndIndexPDFs() {
      try {
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${folder}`);
        if (!res.ok) throw new Error("Dossier non trouv√©");
        const files = await res.json();

        const pdfFiles = files.filter(f => f.type === "file" && f.name.toLowerCase().endsWith('.pdf'));

        if (pdfFiles.length === 0) {
          document.getElementById("status").innerHTML = `Dossier <code>pdf_cours</code> vide ou inexistant.<br>Ajoute tes PDF dedans et rafra√Æchis la page !`;
          return;
        }

        document.getElementById("status").textContent = `Indexation de ${pdfFiles.length} PDF en cours‚Ä¶`;

        for (const file of pdfFiles) {
          const url = `https://raw.githubusercontent.com/${repo}/main/${folder}/${encodeURIComponent(file.name)}`;
          let text = file.name.toLowerCase(); // au minimum le nom est index√©
          try {
            const loadingTask = getDocument(url);
            const pdf = await loadingTask.promise;
            for (let i = 1; i <= pdf.numPages; i++) {
              const page = await pdf.getPage(i);
              const content = await page.getTextContent();
              text += " " + content.items.map(item => item.str).join(" ").toLowerCase();
            }
          } catch (e) { console.log("PDF non lisible : ${file.name}`); }

          pdfs.push({
            name: file.name,
            url: url,
            text: text,
            size: (file.size / 1024 / 1024).toFixed(2)
          });
        }

        document.getElementById("status").textContent = `${pdfs.length} PDF pr√™ts ‚Äì tape ton mot-cl√© ! ‚ö°`;

      } catch (e) {
        document.getElementById("status").innerHTML = `Erreur : le dossier <code>pdf_cours</code> n'existe pas ou est vide.<br>Cr√©e-le et ajoute tes PDF !`;
      }
    }

    const searchInput = document.getElementById("search");
    const resultsDiv = document.getElementById("results");

    searchInput.addEventListener("input", () => {
      const query = searchInput.value.toLowerCase().trim();
      resultsDiv.innerHTML = "";

      if (!query) {
        document.getElementById("noResults").style.display = "none";
        return;
      }

      const found = pdfs.filter(p => p.text.includes(query));

      if (found.length === 0) {
        document.getElementById("noResults").style.display = "block";
        return;
      }
      document.getElementById("noResults").style.display = "none";

      found.forEach(p => {
        const snippet = p.text.includes(query)
          ? "..." + p.text.substring(Math.max(0, p.text.indexOf(query) - 60), p.text.indexOf(query) + query.length + 100).replace(new RegExp(`(${query})`, 'gi'), '<mark>$1</mark>') + "..."
          : "Mot trouv√© dans le document";

        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="name">üìÑ ${p.name}</div>
          <div class="snippet">${snippet}</div>
          <div style="color:#666;">Taille : ${p.size} Mo</div>
          <div class="links">
            <a href="${p.url}" download>‚¨á T√©l√©charger</a>
            <a href="${p.url}" target="_blank">üëÅ Ouvrir</a>
          </div>
        `;
        resultsDiv.appendChild(card);
      });
    });

    loadAndIndexPDFs();
  </script>
</body>
</html>
